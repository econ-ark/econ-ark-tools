\ProvidesPackage{econark-multibib}[2024/06/08 Supports system.bib and filename-Add-Refs.bib]

\RequirePackage{ifthen}
\RequirePackage{etoolbox}

\newcommand{\econarkmultibib}[1]{%
  \def\filename{#1}%
  
  \AtEndDocument{%
    \IfFileExists{\filename-Add-Refs.bib}{%
      \IfFileExists{system.bib}{%
        \IfFileExists{\filename.bib}{%
          \typeout{References in \filename-Add-Refs.bib will take precedence over those elsewhere}%
          \typeout{References in default global system.bib will be used for items not found elsewhere}%
          \bibliography{\filename-Add-Refs,\filename,system}%
        }{%
          \typeout{References in \filename-Add-Refs.bib will take precedence over those elsewhere}%
          \typeout{References in default global system.bib will be used for items not found elsewhere}%
          \typeout{Warning: \filename.bib not found}%
          \bibliography{\filename-Add-Refs,system}%
        }%
      }{%
        \IfFileExists{\filename.bib}{%
          \typeout{References in \filename-Add-Refs.bib will take precedence over those elsewhere}%
          \typeout{Found no global database file}%
          \bibliography{\filename-Add-Refs,\filename}%
        }{%
          \typeout{References in \filename-Add-Refs.bib will take precedence over those elsewhere}%
          \typeout{Found no global database file}%
          \typeout{Warning: \filename.bib not found}%
          \bibliography{\filename-Add-Refs}%
        }%
      }%
    }{%
      \IfFileExists{system.bib}{%
        \IfFileExists{\filename.bib}{%
          \typeout{References in default global system.bib will be used for items not found elsewhere}%
          \bibliography{\filename,system}%
        }{%
          \typeout{References in default global system.bib will be used for items not found elsewhere}%
          \typeout{Warning: \filename.bib not found}%
          \bibliography{system}%
        }%
      }{%
        \IfFileExists{\filename.bib}{%
          \typeout{Found no global database file}%
          \bibliography{\filename}%
        }{%
          \typeout{Found no global database file}%
          \typeout{Warning: \filename.bib not found}%
          \typeout{No bibliography files found}%
        }%
      }%
    }%
  }
